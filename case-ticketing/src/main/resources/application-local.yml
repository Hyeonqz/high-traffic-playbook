spring:
  # ============================================
  # MySQL DataSource 설정 (Master-Replica CQRS)
  # ============================================
  datasource:
    # Master DataSource (Write)
    master:
      driver-class-name: com.mysql.cj.jdbc.Driver
      jdbc-url: jdbc:mysql://localhost:3306/ticketing?useSSL=false&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true
      username: root
      password: root1234
      hikari:
        pool-name: MasterHikariCP
        maximum-pool-size: 50
        minimum-idle: 10
        connection-timeout: 30000
        idle-timeout: 600000
        max-lifetime: 1800000
        connection-test-query: SELECT 1

    # Replica DataSource (Read)
    replica:
      driver-class-name: com.mysql.cj.jdbc.Driver
      jdbc-url: jdbc:mysql://localhost:3307/ticketing?useSSL=false&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Seoul&allowPublicKeyRetrieval=true
      username: root
      password: root1234
      hikari:
        pool-name: ReplicaHikariCP
        maximum-pool-size: 100
        minimum-idle: 20
        connection-timeout: 30000
        idle-timeout: 600000
        max-lifetime: 1800000
        connection-test-query: SELECT 1
        read-only: true

  # ============================================
  # JPA 설정
  # ============================================
  jpa:
    database-platform: org.hibernate.dialect.MySQLDialect
    hibernate:
      ddl-auto: validate
      naming:
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
        implicit-strategy: org.springframework.boot.orm.jpa.hibernate.SpringImplicitNamingStrategy
    properties:
      hibernate:
        format_sql: true
        show_sql: true
        use_sql_comments: true
        default_batch_fetch_size: 100
        jdbc:
          batch_size: 20
          order_inserts: true
          order_updates: true
        query:
          in_clause_parameter_padding: true
          plan_cache_max_size: 2048
        generate_statistics: false
    open-in-view: false

  # ============================================
  # Redis 설정 (Master-Slave with Sentinel)
  # ============================================
  data:
    redis:
      # Sentinel 모드 설정
      sentinel:
        master: mymaster
        nodes:
          - localhost:26379
      password:
      database: 0
      timeout: 3000ms

      # Lettuce 설정
      lettuce:
        pool:
          max-active: 20
          max-idle: 10
          min-idle: 5
          max-wait: 3000ms
        shutdown-timeout: 200ms

      # 읽기 전략: Slave 우선 읽기 (부하 분산)
      # 옵션: MASTER, MASTER_PREFERRED, REPLICA, REPLICA_PREFERRED
      client-type: lettuce

  # ============================================
  # Kafka 설정
  # ============================================
  kafka:
    bootstrap-servers: localhost:9092,localhost:9093,localhost:9094
    consumer:
      group-id: ticketing-group
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all
      retries: 3
    listener:
      ack-mode: manual

  # ============================================
  # Cache 설정
  # ============================================
  cache:
    type: redis
    redis:
      time-to-live: 3600000  # 1시간 (ms)
      cache-null-values: false
      key-prefix: "cache:"

  # ============================================
  # Spring Boot Admin Client 설정
  # ============================================
  boot:
    admin:
      client:
        url: http://localhost:9900/admin
        instance:
          prefer-ip: true
          service-base-url: http://localhost:8400
        username: ${ADMIN_USERNAME:admin}
        password: ${ADMIN_PASSWORD:admin123!}

# ============================================
# Management Endpoints
# ============================================
management:
  endpoints:
    web:
      exposure:
        include: "*"
  endpoint:
    health:
      show-details: always
  health:
    redis:
      enabled: true
    db:
      enabled: true

# ============================================
# Logging
# ============================================
logging:
  level:
    io.github.hyeonqz: DEBUG
    org.hibernate.SQL: INFO
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
    org.springframework.kafka: INFO
    org.springframework.data.redis: DEBUG
    io.lettuce.core: DEBUG
    com.zaxxer.hikari: INFO

# ============================================
# Custom Application Properties
# ============================================
app:
  # 대기열 설정
  queue:
    max-size: 100000
    admit-rate: 1000  # 초당 입장 허용 수
    token-expire-seconds: 300  # 토큰 유효 시간 (5분)

  # Rate Limiting 설정
  rate-limit:
    general-api: 10  # 일반 API: 초당 10 요청/사용자
    reservation-api: 1  # 예매 API: 초당 1 요청/사용자
    queue-api: 5  # 대기열 API: 초당 5 요청/사용자

  # 재고 관리 설정
  inventory:
    sync-interval-seconds: 60  # Redis-MySQL 재고 동기화 간격
